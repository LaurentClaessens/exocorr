%% This is file `exocorr.sty',
%%
%% Copyright (c) 2010 Laurent Claessens <moky.math@gmail.com>.
%% 
%% This program may be distributed and/or modified under the conditions of the LaTeX Project
%% Public License, either version 1.3 of this license or (at your option) any later version.
%% The latest version of this license is in http://www.latex-project.org/lppl.txt and
%% version 1.3a or later is part of all distributions of LaTeX version 2003/12/01 or later.
%% 

% This package can be downloaded from
% git@gitorious.org:exocorr/exocorr.git

% this package needs the package calc for computation with \widthof

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{exocorr}[31/01/2009, version 0.1]

\newboolean{LangageFR}
\setboolean{LangageFR}{false}
\DeclareOption{fr}{\setboolean{LangageFR}{true}}
\ProcessOptions

% ENGLISH DEFAULT TEXTS
\newcommand{\@ExoTheoremName}{Exercise}
\newcommand{\@CorrText}{Correction of the exercise}
\newcommand{\@AlternativeText}{Other resolution}
\newcommand{\@LinkToCorrText}{Correction at page}

% FRENCH TRANSLATIONS
\ifthenelse{\boolean{LangageFR}}{%
\renewcommand{\@ExoTheoremName}{Exercice}
\renewcommand{\@CorrText}{Correction de l'exercice}
\renewcommand{\@AlternativeText}{Résolution alternative}
\renewcommand{\@LinkToCorrText}{Correction à la page}
}{}
 
\newcounter{CountExercice}

\newlength{\SymbolWidth}
\newenvironment{exercice}[1][]{%
\refstepcounter{CountExercice}%
\setlength{\SymbolWidth}{\widthof{#1}}%
\par
\noindent%
\hspace{-\SymbolWidth}
\hspace{-15pt}
{\bf #1 \@ExoTheoremName\ \theCountExercice}\noindent%
}{}
%\newenvironment{exercice}[1]{Exercice}{}

\newenvironment{corrige}[1]{\par\bigskip\noindent {\bf \@CorrText\ \ref{exo#1}}\label{corr#1}\par\nopagebreak}{}
\newenvironment{alternative}{\par\bigskip\noindent {\bf \@AlternativeText\ }\par\nopagebreak}{}

\newcounter{@CorrPosition}
\newcommand{\corrPosition}[1]{\setcounter{@CorrPosition}{#1}}
% 0 : No corrections 
% 1 : Correction immediately under the questions
% 2 : Corrections in a specific chapter, use \corrChapitre

% Pour mettre les corrigés au bout, il faut initialiser le fichier dans lequel on écrit.
\newwrite\FichCorr
\immediate\openout\FichCorr=corr	

\newcommand{\corrChapitre}[1]{%
\ifthenelse{\value{@CorrPosition}=2}{%
\chapter{#1}
	\immediate\closeout\FichCorr
	\input{corr}
}{}		% Fin du ifthenelse
}		% Fin de la macro \corrChapitre

\newcommand{\corrref}[1]{%
\ifthenelse{\value{@CorrPosition}=2}{\par \@LinkToCorrText\ \pageref{corr#1}.}{}%
}

% The optional first argument says if you want to include the correction.
% \Exo{bla}  will include the correction (if exists)
% \Exo[0]{bla} will not include the correction, even if it exists

\newcommand{\Exo}[2][1]{%
\input{exo#2}
\ifthenelse{#1=1}{
\ifthenelse{\value{@CorrPosition}=1}{\IfFileExists{corr#2.tex}{\input{corr#2}}{}}{}
\ifthenelse{\value{@CorrPosition}=2}{\IfFileExists{corr#2.tex}{\immediate\write\FichCorr{\string\input{corr#2}}}{}}{}
}
{}
}

% Ces histoires de \newwrite pour écrire dans un fichier sont par exemple expliquées sur le fctt [1]
% Le \immediate vient de la discussion fctt [2]

% The following uses xstring in order to replace specific characters by %xx codes.
% See the table http://www.utf8-chartable.de/
\newcommand{\MakeUTFPerCent}[1]{% 
   \StrSubstitute{#1}({\%28}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}){\%29}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{à}{\%C3\%A0}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{â}{\%C3\%A2}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{ç}{\%C3\%A7}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{è}{\%C3\%A8}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{é}{\%C3\%A9}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{ê}{\%C3\%AA}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{ù}{\%C3\%B9}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{û}{\%C3\%BB}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}{ô}{\%C3\%B4}[\result]% 
   \expandafter\StrSubstitute\expandafter{\result}_{\_}[\result]% 
} 
%------------------------
% Links to wikipedia.
%------------------------
% Typical use is
% \wikipedia{fr}{Norme_(mathématiques)}{Norme}
% It creates the link \href to the right page on wikipedia, replacing special characters by their respective %xx codes.
\newcommand{\wikipedia}[3]{% 
   \saveexpandmode\noexpandarg 
   \MakeUTFPerCent{#2}% 
   \restoreexpandmode 
   \href{http://#1.wikipedia.org/wiki/\result}{#3}% 
} 

\endinput

% [1] http://groups.google.fr/group/fr.comp.text.tex/browse_thread/thread/76eb44e2e928ba8b/ab0f092c79a062cd?hl=fr&lnk=gst&q=newwrite#ab0f092c79a062cd 
% [2] http://groups.google.fr/group/fr.comp.text.tex/browse_thread/thread/80909a66028ef5a3/ab89634948317f36?hl=fr#ab89634948317f36
% [3] http://groups.google.fr/group/fr.comp.text.tex/browse_thread/thread/b2a0fa029bf9e0d9/fd3b47dfaac9cc96?hl=fr&lnk=gst&q=shorthand#fd3b47dfaac9cc96
% [4] http://groups.google.fr/group/fr.comp.text.tex/browse_thread/thread/68bf87c02c4515bc?hl=fr#
